# Деплой проекта

Проект настроен для автоматического деплоя на GitHub Pages через GitHub Actions.

## Автоматический деплой

### Настройка GitHub Pages

1. В настройках репозитория GitHub (`Settings` → `Pages`):
   - Источник: `GitHub Actions`
   - Ветка: оставьте по умолчанию

2. Убедитесь, что в репозитории есть workflow файл:
   - `.github/workflows/deploy.yml`

### Структура workflow

Workflow состоит из двух джобов:
- **build**: сборка проекта и создание артефакта
- **deploy**: деплой артефакта на GitHub Pages

Workflow использует официальные GitHub Actions:
- `actions/checkout@v4` - получение кода
- `actions/setup-node@v4` - настройка Node.js с кешированием
- `actions/configure-pages@v4` - настройка GitHub Pages
- `actions/upload-pages-artifact@v3` - загрузка артефакта
- `actions/deploy-pages@v4` - деплой на GitHub Pages

### Процесс деплоя

При каждом push в ветку `main` (или при ручном запуске через `workflow_dispatch`):

1. GitHub Actions запускает workflow "Deploy to GitHub Pages"
2. Устанавливаются зависимости (`npm ci`)
3. Выполняется сборка проекта (`npm run build`)
4. Статические файлы из папки `out/` загружаются как артефакт
5. GitHub Pages автоматически деплоит артефакт и обновляет сайт

### Проверка статуса деплоя

1. Перейдите во вкладку `Actions` в репозитории GitHub
2. Найдите последний запуск workflow "Deploy to GitHub Pages"
3. Проверьте статус выполнения

## Ручной деплой

Если автоматический деплой не настроен или нужно задеплоить вручную:

### Метод 1: Через GitHub CLI

```bash
# Соберите проект
npm run build

# Установите GitHub CLI (если не установлен)
# brew install gh  # для macOS

# Залогиньтесь
gh auth login

# Задеплойте в ветку gh-pages
npm run deploy
# (если скрипт настроен в package.json)
```

### Метод 2: Через git

```bash
# Соберите проект
npm run build

# Переключитесь на ветку gh-pages
git checkout gh-pages

# Скопируйте содержимое папки out/ в корень
cp -r out/* .

# Закоммитьте и отправьте
git add .
git commit -m "Deploy to GitHub Pages"
git push origin gh-pages

# Вернитесь на main
git checkout main
```

### Метод 3: Через gh-pages пакет

1. Установите пакет:
```bash
npm install --save-dev gh-pages
```

2. Добавьте скрипт в `package.json`:
```json
{
  "scripts": {
    "deploy": "gh-pages -d out"
  }
}
```

3. Запустите деплой:
```bash
npm run deploy
```

## Настройка basePath

Важно: для работы на GitHub Pages нужно правильно настроить `basePath` в `next.config.ts`.

Если репозиторий называется `vaskes79.github.io`, используйте:
```typescript
basePath: ''
```

Если репозиторий имеет другое имя (например, `my-portfolio`), используйте:
```typescript
basePath: '/my-portfolio'
```

## Проверка после деплоя

После деплоя проверьте:

1. ✅ Сайт доступен по адресу: `https://vaskes79.github.io` (или ваш адрес)
2. ✅ Все страницы загружаются корректно
3. ✅ Темы переключаются правильно
4. ✅ Локализация работает
5. ✅ MDX контент отображается
6. ✅ Навигация функционирует

## Решение проблем

### Сайт показывает 404

- Проверьте настройку `basePath` в `next.config.ts`
- Убедитесь, что файл `404.html` существует в папке `out/`
- Проверьте, что GitHub Pages использует источник `GitHub Actions` в настройках репозитория
- Убедитесь, что workflow успешно завершился (проверьте вкладку `Actions`)

### Изображения не загружаются

- Убедитесь, что изображения находятся в папке `public/`
- Проверьте пути к изображениям (должны быть относительно `basePath`)

### Темы не работают

- Проверьте, что `next-themes` правильно работает в статическом режиме
- Убедитесь, что скрипт инициализации темы выполняется на клиенте

### Локализация не работает

- Проверьте, что клиентский редирект работает в корневом `app/page.tsx`
- Убедитесь, что все файлы локализации включены в сборку
- Проверьте, что JavaScript включен в браузере (для клиентского редиректа)

## Откат к предыдущей версии

Если нужно откатиться к предыдущей версии:

1. Найдите нужный коммит в истории:
```bash
git log --oneline
```
2. Откатите изменения в ветке `main`:
```bash
git revert <commit-hash>
git push origin main
```
3. GitHub Actions автоматически задеплоит предыдущую версию

Альтернативно, можно перезапустить workflow из предыдущего успешного коммита через GitHub Actions UI.

## Окружения

- **Production**: автоматический деплой на GitHub Pages через Actions
- **Preview**: локальный предпросмотр через `npm run build && npx serve out`

## Мониторинг

Для мониторинга доступности сайта можно использовать:
- GitHub Pages статус (в настройках репозитория)
- Внешние сервисы мониторинга (UptimeRobot, Pingdom и т.д.)

